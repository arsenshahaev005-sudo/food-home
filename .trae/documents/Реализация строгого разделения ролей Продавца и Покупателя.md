# План реализации строгого разделения сессий

Я проанализировал текущую реализацию и понял, что проблема заключается в том, что система проверяет *наличие* магазина (`producer_id`), а не выбранную при входе роль.

Чтобы реализовать требуемое поведение ("Продавец должен выйти и зайти как покупатель"), мы сделаем следующее:

## 1. Исправление логики входа (`login/page.tsx`)
Сейчас при обычном входе (Email/Phone) пользователя всегда перекидывает в `/profile`.
**Что сделаем:**
*   В функции `handleLogin` добавим проверку роли, которую вернул сервер (`res.role`).
*   Если `res.role === 'SELLER'`, перенаправляем сразу на `/seller`.
*   Иначе — на `/profile`.

## 2. Исправление страницы профиля (`profile/page.tsx`)
Сейчас страница проверяет `p.role === 'SELLER' || p.producer_id`. Второе условие (`producer_id`) ошибочно заставляет продавца, вошедшего как покупатель, улетать обратно в кабинет.
**Что сделаем:**
*   Уберем проверку `p.producer_id`.
*   Редирект на `/seller` будет срабатывать **только** если текущая сессия запущена с ролью `'SELLER'`.

## 3. Защита кабинета продавца (`seller/page.tsx`)
Сейчас там тоже есть "слабая" проверка, позволяющая оставаться на странице, если есть `producer_id`.
**Что сделаем:**
*   Ужесточим проверку: если текущая роль в сессии не `'SELLER'` (то есть `'CLIENT'`), принудительно отправляем пользователя на `/profile`.

**Результат:**
*   Вход "Я продавец" -> Кабинет продавца. (Попытка зайти в профиль вернет в кабинет).
*   Вход "Я покупатель" -> Профиль покупателя. (Попытка зайти в кабинет вернет в профиль).
*   Для смены режима нужно разлогиниться и войти с другой ролью.